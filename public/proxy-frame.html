<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数学の考え方　概念として覚えよう</title>
  <link rel="stylesheet" href="/assets/css/frame.css" />

  <style>
    /* =========================================
       Chrome Refresh 2023 Design Tokens
    ========================================= */
    :root {
      --chrome-bg: #f1f3f4;
      --chrome-tab-active: #ffffff;
      --chrome-tab-hover: rgba(60, 64, 67, 0.08);
      --chrome-toolbar: #ffffff;
      --chrome-border: #dee1e6;
      --chrome-text: #1f1f1f;
      --chrome-muted: #474747;
      --chrome-accent: #1a73e8;
      --sennin-blue: #4f9cff;
      --radius-tab: 12px;
      --radius-input: 24px;
      --ease-out: cubic-bezier(0.2, 0, 0, 1);
      --dur: 0.2s;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --chrome-bg: #202124;
        --chrome-tab-active: #35363a;
        --chrome-tab-hover: rgba(255, 255, 255, 0.1);
        --chrome-toolbar: #35363a;
        --chrome-border: #1c1c1e;
        --chrome-text: #e3e3e3;
        --chrome-muted: #9aa0a6;
        --chrome-accent: #8ab4f8;
      }
    }

    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    
    html, body {
      margin: 0; padding: 0; height: 100vh;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--chrome-bg);
      color: var(--chrome-text);
      display: flex; flex-direction: column;
      overflow: hidden;
    }

    /* Tabs UI */
    .tab-strip {
      height: 44px;
      display: flex;
      align-items: flex-end;
      padding: 0 8px;
      gap: 0;
      -webkit-user-select: none;
    }
    .tab {
      position: relative; height: 34px; width: 240px;
      background: transparent;
      border-radius: var(--radius-tab) var(--radius-tab) 0 0;
      display: flex; align-items: center;
      padding: 0 8px 0 16px; font-size: 12px;
      cursor: default; transition: background var(--dur);
      animation: tabAppear 0.3s var(--ease-out);
    }
    @keyframes tabAppear {
      from { width: 0; opacity: 0; }
      to { width: 240px; opacity: 1; }
    }
    .tab.active { background: var(--chrome-toolbar); }
    .tab-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .close-tab { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .close-tab:hover { background: var(--chrome-tab-hover); }

    .new-tab-btn { width: 28px; height: 28px; border-radius: 50%; border: none; background: transparent; cursor: pointer; margin-bottom: 4px; color: var(--chrome-muted); }
    .new-tab-btn:hover { background: var(--chrome-tab-hover); }

    /* Toolbar */
    .toolbar {
      height: 48px; background: var(--chrome-toolbar);
      display: flex; align-items: center; padding: 0 10px; gap: 8px;
      border-bottom: 1px solid var(--chrome-border);
    }
    .nav-btn { width: 34px; height: 34px; border-radius: 50%; border: none; background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .nav-btn:hover { background: var(--chrome-tab-hover); }

    .omnibox {
      flex: 1; height: 34px; background: var(--chrome-bg);
      border-radius: var(--radius-input); display: flex; align-items: center; padding: 0 16px;
    }
    .omnibox-input { width: 100%; background: transparent; border: none; font-size: 14px; color: var(--chrome-text); }

    /* Content Area */
    .content-area { flex: 1; position: relative; background: white; }
    .view-container { width: 100%; height: 100%; position: absolute; display: none; }
    .view-container.active { display: block; }
    iframe { width: 100%; height: 100%; border: none; background: white; }

    .loading-bar { position: absolute; top: 0; left: 0; height: 3px; width: 0%; background: var(--chrome-accent); transition: width 0.4s; z-index: 100; }
    .sennin-logo { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; opacity: 0.8; }
    .sennin-logo h1 { font-size: 48px; color: var(--sennin-blue); margin: 0; }
  </style>
</head>

<body>

  <div class="loading-bar" id="loadingBar"></div>

  <header class="tab-strip" id="tabs">
    <button class="new-tab-btn" onclick="createTab()">+</button>
  </header>

  <div class="toolbar">
    <div class="nav-btns">
      <button class="nav-btn" onclick="goBack()">←</button>
      <button class="nav-btn" onclick="goForward()">→</button>
      <button class="nav-btn" onclick="reloadTab()">↻</button>
    </div>
    
    <form id="uv-form" class="omnibox">
      <input id="uv-address" type="text" class="omnibox-input" placeholder="検索またはURLを入力" autocomplete="off">
    </form>
  </div>

  <main class="content-area" id="viewport">
    <div class="sennin-logo" id="home-logo">
      <h1>senninproxy</h1>
    </div>
  </main>

  <script src="/uv/uv.bundle.js"></script>
  <script src="/uv/uv.config.js"></script>
  <script src="/assets/js/frame.js"></script>

  <script>
    let tabCounter = 0;
    let activeTabId = null;
    const tabsContainer = document.getElementById("tabs");
    const addressInput = document.getElementById("uv-address");
    const viewport = document.getElementById("viewport");
    const homeLogo = document.getElementById("home-logo");
    const loadingBar = document.getElementById("loadingBar");

    function createTab(name = "新しいタブ") {
      const id = "tab-" + (++tabCounter);
      const tab = document.createElement("div");
      tab.className = "tab active";
      tab.dataset.id = id;
      tab.innerHTML = `
        <span class="tab-title">${name}</span>
        <div class="close-tab" onclick="event.stopPropagation();closeTab('${id}')">×</div>
      `;
      tab.onclick = () => switchTab(id);

      const container = document.createElement("div");
      container.className = "view-container active";
      container.id = "view-" + id;
      
      // 最初は proxy.html または about:blank を表示
      const iframe = document.createElement("iframe");
      iframe.src = "about:blank";
      container.appendChild(iframe);
      viewport.appendChild(container);

      document.querySelectorAll(".tab, .view-container").forEach(el => el.classList.remove("active"));
      tabsContainer.insertBefore(tab, document.querySelector(".new-tab-btn"));
      activeTabId = id;
      updateHomeVisibility();
    }

    function switchTab(id) {
      activeTabId = id;
      document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.dataset.id === id));
      document.querySelectorAll(".view-container").forEach(v => v.classList.toggle("active", v.id === "view-" + id));
      updateHomeVisibility();
    }

    function closeTab(id) {
      document.querySelector(`.tab[data-id="${id}"]`).remove();
      document.getElementById("view-" + id).remove();
      if (activeTabId === id) {
        const lastTab = document.querySelector(".tab");
        if (lastTab) switchTab(lastTab.dataset.id);
        else createTab();
      }
    }

    function updateHomeVisibility() {
      const iframe = document.querySelector(`#view-${activeTabId} iframe`);
      homeLogo.style.display = (!iframe || iframe.src === "about:blank") ? "block" : "none";
    }

    async function registerSW() {
      if ("serviceWorker" in navigator) {
        await navigator.serviceWorker.register("/sw.js", { scope: __uv$config.prefix });
      }
    }

    document.getElementById("uv-form").onsubmit = async (e) => {
      e.preventDefault();
      const val = addressInput.value.trim();
      if (!val) return;

      await registerSW();
      loadingBar.style.width = "75%";

      let url = val;
      if (!val.includes(".") && !val.startsWith("http")) {
        url = "https://www.google.com/search?q=" + encodeURIComponent(val);
      } else if (!val.startsWith("http")) {
        url = "https://" + val;
      }

      const iframe = document.querySelector(`#view-${activeTabId} iframe`);
      iframe.src = __uv$config.prefix + __uv$config.encodeUrl(url);
      
      document.querySelector(`.tab[data-id="${activeTabId}"] .tab-title`).textContent = val;
      
      iframe.onload = () => {
        loadingBar.style.width = "100%";
        setTimeout(() => loadingBar.style.width = "0%", 300);
        updateHomeVisibility();
      };
    };

    function goBack() { document.querySelector(`#view-${activeTabId} iframe`).contentWindow.history.back(); }
    function goForward() { document.querySelector(`#view-${activeTabId} iframe`).contentWindow.history.forward(); }
    function reloadTab() { document.querySelector(`#view-${activeTabId} iframe`).contentWindow.location.reload(); }

    createTab();
  </script>
</body>
</html>
